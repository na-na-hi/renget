#FizzleDorf's Animation Guide - Parseq

return to main page:
https://rentry.org/AnimAnon

!!!note Github page: https://github.com/rewbs/sd-parseq

Web app link: https://sd-parseq.web.app/?docId=doc-0137920a-27b4-4fb6-bdfd-80ecfaf8a090

-----

#Index

[TOC2]

-----

##Introduction

A Parameter Sequencer used for AI animations in Deforum. Parseq exports the rendered sequence from it's Webapp to json and is imported into Deforum under the Keyframes tab, at the very bottom. 

->![Imgur](https://i.imgur.com/izk0CB6.jpg)<-

->![Imgur](https://i.imgur.com/KgK1gzp.jpg)<-

!!! See what Parseq does and does not override for Deforum parameters in the Parseq dropdown and make sure you set these settings inside the A1111 webui before you generate.

For a list of functions, variables and operations, the README on the Parseq github page lists them out and provides examples. I've also included a pastebin for quick reference here or for you to copy/paste for your own reference locally: [Parseq Reference Sheet](https://pastebin.com/LsBkj9L2)

==To start a new project, copy over the settings from another project or the one you are working on and paste it in the import input found in the Load options.==

Blank Parseq project file for starting with a clean slate: [Blank project](https://pastebin.com/SYDdZ4TV)


-----

##Prompts

->![Imgur](https://i.imgur.com/MkRxY3U.jpg)<-

Prompt syntax for the prompt weight interpolations is:

```C++
${prompt_weight_1}
```
The weight channels are numbered 1 to 8 (not zero indexed).  

We can use these weights to interpolate the weights of a token or a full prompt using the AND operator. In the default positive prompt example:
```C++
A lone white (cat:${prompt_weight_3}) (duck:${prompt_weight_4}) at midday, centered, realistic, photorealism, crisp, natural colors, fine textures, highly detailed, volumetric lighting, studio photography:${prompt_weight_1} AND
  A lone black (cat:${prompt_weight_3}) (duck:${prompt_weight_4}) at midnight, centered, realistic, photorealism, crisp, natural colors, fine textures, highly detailed, volumetric lighting, studio photography :${prompt_weight_2}
```

PromptA's weight is assigned to `${prompt_weight_1}`

PromptB's weight is assigned to `${prompt_weight_2}`

The "cat" token's weight is assigned to `${prompt_weight_3})`

The "duck" token's weight is assigned to `${prompt_weight_4})`

These prompt weight channels are for interpolating the weights using the Keyframes for Parameter flow *see next section.* Interpolating between the full prompts or the token weights is going to be the main thing to keep in mind when moving forward. Don't forget there is a negative prompt input as well.

-----

##Keyframes for Parameter Flow

->![Imgur](https://i.imgur.com/u9a3ww2.jpg)<-

The Keyframes for Parameter flow is where we make out inputs for keying out prompts and keyframe parameters in Deforum. 

Before you begin, make sure to set your BPM and the fps as this affects how many node placements of the waves on each frame and is needed for syncing music or audio using the beats variable `b`. If your Deforum fps is not matching the Parseq ones, it will convert although it's recommended you match them in order to keep the timing intact. 

Each parameter has two columns associated with them. The left column is for input of a value at the keyframe it's entered at (only takes numbers, no arithmetic). You need to specify a value at the beginning and the end so a render can take place (you will see an error message otherwise). The right column `marked with a ->` is for expressions and functions (There must at least be a specified trpye of interpolation in order to render ie: L or C). You can add/remove keyframes using the `ADD/REMOVE KEYFRAME` buttons located in the bottom left. You can check on/off `render on every edit` to keep from piling up saves to the project, you can save manually by selecting the `Force-Re-Render`. *The Visualized Parameter Flow will not be updated until the changes are rendered*

-----

##Visualized Parameter Flow

->![Imgur](https://i.imgur.com/qs8W6MH.jpg)<-

A quick way to visualize the waves across the animation sequence. You can also filter the parameters by selecting the names in the line colour legend under the chart. You can also use your mouse cursor to see information on keyframes along any visualized line or wave.

-----

##Sparklines

->![Imgur](https://i.imgur.com/ybPgegT.jpg)<-

Handy for toggling the visibility of keyframed parameters. Simply select the the sparkline you want active in the visualized parameter flow. The Parameter also shows up in the keyframe parameter flow table for editing.

-----

##Output

->![Imgur](https://i.imgur.com/spvEdfR.jpg)<-

The json text that is generated by the parameter inputs when rendered. This text is to be copied and pasted into the Deforum Parseq manifest input (The input box in the Parseq dropdown. Error messages will also appear at the top in case values are mission or there is a problem with syntax. You can revert your project by selecting revert and the saved project at the save time.

-----

##Controlled Parameters and Settings

This section is for settings to get nice pose to pose interpolations using the tools available. I will leave links to the appropriate sections in the Deforum guide for reference.

###Strength

Reference:
https://rentry.org/AnimAnon-Deforum#generation-settings

This is the denoise value over time/beats/frames. Below are some different ways to implement different interpolations.

For the examples, I tested with and without an init image.

Deforum settings for the examples:
https://pastebin.com/TjNW1AZa

The init image:

->![Imgur](https://i.imgur.com/pT8c3k7.png)<-

-----

->==>>>>>Linear<<<<<==<-

Easiest way to plan out the interpolation. Just set and forget. In order to get it working it is simple `L` in the function column with 0.6 keyed at 0 and the last keyframe.

->![Imgur](https://i.imgur.com/63TvUc1.jpg)<-

Example with init image:

->![Imgur](https://i.imgur.com/9VoWYaH.gif)<-

Example without:

->![Imgur](https://i.imgur.com/i2ywd0Q.gif)<-

Project file:
https://sd-parseq.web.app/?importRemote=doc-e9a52ba2-ce37-4aa2-8f49-e18b9cea4763-1672680522546.json&token=18ded0b5-6b64-4860-9ab5-2be998abaaac

-----

->==>>>>>Loopback Wave<<<<<==<-

An easier way of Setting up the LBWave function in Parseq is to use:

```L - abs(sin(p=2b,a=0.2,ps=8))```

Where the keyed value is the max denoise and the amplitude controls 

->![Imgur](https://i.imgur.com/MfqkQ0P.jpg)<-

Example with init image:

->![Imgur](https://i.imgur.com/ic0sC2w.gif)<-

Example without:

->![without](https://i.imgur.com/XQVpvd0.gif)<-

Project File:
https://sd-parseq.web.app/?importRemote=doc-13d110e2-df18-473a-8755-7f2e12b7f87d-1672601119789.json&token=ca34e015-c128-4fef-bef6-3af6f6dd783e

-----

->==>>>>>Sine Wave<<<<<==<-
A simple, sine wave interpolation. Use `c` inside the wave function to adjust the midpoint of the wave and `a` for the difference/2.

```sin(p=2b,a=0.1,ps=8, c=50)```

Example with init image:

->![Imgur](https://i.imgur.com/SC1hwIn.gif)<-

Example without:

->![Imgur](https://i.imgur.com/jjyvq6o.gif)<-

Project File:
https://sd-parseq.web.app/?importRemote=doc-13d110e2-df18-473a-8755-7f2e12b7f87d-1672606589450.json&token=86d4fa95-f1ed-47b7-bf12-6c35c9b12ec7

-----

->==>>>>>Triangle Wave<<<<<==<-

Just like LBWave, an easier way of Setting up the triangle wave function in Parseq is to use:

```L - abs(tri(p=2b,a=0.2,ps=8))```

Where the keyed value is the max denoise and the amplitude controls the difference between the max and min denoise.

->![Imgur](https://i.imgur.com/voRAeFj.jpg)<-

Example with input image:

->![Imgur](https://i.imgur.com/FHSC9aL.gif)<-

Example without:

->![Imgur](https://i.imgur.com/VBSjWK8.gif)<-

Project files:
https://sd-parseq.web.app/?importRemote=doc-7ff9c8c8-53a8-43c7-86a5-7a36e99a4dea-1672600999906.json&token=ddbbfe59-9963-4fe6-95aa-82094ccc6ed4


->==>>>>>Pulse Wave<<<<<==<-

The pulse wave can force abrupt change in the animated subject when it hits the low denoise then springs back up to the high point.

```L - pulse(p=1b, pw=0.5,a=0.4)```

->![PWDenoise](https://i.imgur.com/9hhELIy.jpg)<-


Example with input image:

==@between 0.2 denoise and 0.6 denoise==

->![Imgur](https://i.imgur.com/70aUxs9.gif)<-

==@between 0.4 denoise and 0.6 denoise==

->![Imgur](https://i.imgur.com/3yNYnGM.gif)<-

==@between 0.4 denoise and 0.5 denoise==

->![Imgur](https://i.imgur.com/8ux2geb.gif)<-

Example without:

==@between 0.2 denoise and 0.6 denoise==

->![Imgur](https://i.imgur.com/fm7OAnn.gif)<-

==@between 0.4 denoise and 0.6 denoise==

->![Imgur](https://i.imgur.com/aN14CQZ.gif)<-

==@between 0.4 denoise and 0.5 denoise==

->![Imgur](https://i.imgur.com/Sh3GQu2.gif)<-

Project file (Project file)
https://sd-parseq.web.app/?importRemote=doc-e9a52ba2-ce37-4aa2-8f49-e18b9cea4763-1672684216280.json&token=2e8778bd-395b-43b0-b504-12c98d719e1c

-----

###Noise

Reference:
https://rentry.org/AnimAnon-Deforum#generation-settings

This is the amount of extra noise to add over time. I normally leave this linear at the default Deforum setting `0.8` but theoretically it should influence more movement when applied to the peaks of the denoise waves.


###Prompt Weights

!!! Make sure you read the Prompts section of this guide for the syntax to link your channels.

The amount of attention a prompt weight has over time. Curves tent to have slow and smooth transitions between the weights while sharp changes to the waves tend to interpolated faster and more rigid. You can do whatever you like over linear denoise and it will probably interpolate pretty smoothly. The denoise waves can be used to influence more motion when paired with prompt weights *See denoise examples*


###Camera Controls

!!!I'll be going over tests to make sure I know for sure how camera settings also influence subject movement. 

Interpolates the camera controls in Deforum. Super handy having the visualizations to track movements and sync other parameters.

####2D and 3D

Reference:
https://rentry.org/AnimAnon-Deforum#2d-and-3d


->==>>>>>Angle<<<<<==<-

->==>>>>>Zoom<<<<<==<-

->==>>>>>Translation X<<<<<==<-

->==>>>>>Translation Y<<<<<==<-

####2D

Reference:
https://rentry.org/AnimAnon-Deforum#2d

->==>>>>>Perspective flip theta<<<<<==<-

->==>>>>>Perspective flip phi<<<<<==<-

->==>>>>>Perspective flip gamma<<<<<==<-

->==>>>>>Perspective flip fv<<<<<==<-



####3D

Reference:
https://rentry.org/AnimAnon-Deforum#2d

->==>>>>>Translation Z<<<<<==<-

->==>>>>>Rotation X<<<<<==<-

->==>>>>>Rotation Y<<<<<==<-

->==>>>>>Rotation Z<<<<<==<-

-----

###Seed
The seed in any of the img2img modes must have a seed traveling all the time otherwise there will be a blooming effect. This can be a Linear interpolation from the starting seed then add the difference of frames at the last keyframe (same as iter). You could also travel up and down the seed with a linear interpolation or a triangle wave. any sort of curve tends to get the blooming effect the same way a fixed seed does. There may be a use case for a saw wave too but I find the transition really abrupt.

You can plug this into the seed function column for a quick and easy iterative mode off of the seed you specify in the value column.

```C++
L + k
```

###Scale
The CFG Scale amount. There is some movement influence from the CFG scale but you would need to feel around for where variation takes over. Higher CFG is more forgiving than lower ones for traveling up and down. Any linear interpolation or curve would work well here unless you want sharp changed, then go with pulse and sawtooth waves.

###Fov
A way of boosting the depth warping effect. I've done a little experimentation with it but need to do more tests to give good results.

###Contrast

Contrast of the image. Haven't done much messing around with it but it's pretty straight forward.

###Anti Blur

!!! This feature is relatively new and requires some more experimentation so I'll return to this. Feel free to experiment with the settings though.



return to main page:
https://rentry.org/AnimAnon
